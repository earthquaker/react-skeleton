Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = startClient;
var WebSocket = require("ws");

var _require = require("./console");

var info = _require.info;

var noop = function noop() {};

function startClient(scope$$, onMsg) {
  if (!scope$$.ws) {
    (function () {
      var url = makeHostUrl(scope$$);
      info("Connect reload client to " + url);

      var ws = new WebSocket(url);
      ws.onopen = function () {
        return info("WebSocket client listening for changes...");
      };

      ws.onmessage = function (m) {
        var msg = JSON.parse(m.data);
        var res = (onMsg[msg.type] || noop)(msg);
        if (res) {
          ws.send(JSON.stringify(res));
        }
      };

      scope$$.ws = ws;
    })();
  }
}

function makeHostUrl(_ref) {
  var _ref$options = _ref.options;
  var host = _ref$options.host;
  var port = _ref$options.port;

  var protocol = window.location.protocol === "https:" ? "wss" : "ws";
  return protocol + "://" + host + ":" + port;
}
module.exports = exports["default"];