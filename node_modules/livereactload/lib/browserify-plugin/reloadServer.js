Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.startServer = startServer;

var _require = require("ws");

var Server = _require.Server;

var _require2 = require("./console");

var log = _require2.log;

var _require3 = require("../common");

var pairs = _require3.pairs;

function startServer(_ref) {
  var port = _ref.port;

  var wss = new Server({ port: port });

  log("Reload server up and listening in port " + port + "...");

  var server = {
    notifyReload: function notifyReload(metadata) {
      if (wss.clients.length) {
        log("Notify clients about bundle change...");
      }
      wss.clients.forEach(function (client) {
        client.send(JSON.stringify({
          type: "change",
          data: metadata
        }));
      });
    }
  };

  wss.on("connection", function (client) {
    log("New client connected");
  });

  return server;
}